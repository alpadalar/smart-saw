---
phase: 11-initial-delay-logic
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/services/control/manager.py]
autonomous: true
---

<objective>
Make initial_delay logic mode-aware: only apply to ML mode, skip for manual mode.

Purpose: Manual mode should have no artificial delay at cutting start — operator expects immediate control response. ML mode retains delay to allow material engagement before AI adjustments.
Output: Modified ControlManager with mode-aware initial delay behavior.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-ai-mode-switch-fix/10-01-SUMMARY.md
@src/services/control/manager.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make _check_initial_delay mode-aware</name>
  <files>src/services/control/manager.py</files>
  <action>
Modify `_check_initial_delay()` method to accept current mode or check self._current_mode internally.

Two approaches (choose simpler):
A) Move the delay check inside the ML branch (cleanest)
B) Add mode check at start of _check_initial_delay (least code change)

Option A is cleaner — only call _check_initial_delay when in ML mode:

```python
if is_cutting:
    # Delegate to active controller
    if self._current_mode == ControlMode.ML:
        # Check initial delay (only for ML mode)
        if not self._check_initial_delay(raw_data):
            return None
        return await self.ml_controller.calculate_speeds(processed_data)
    else:
        # Manual mode - no automatic speed changes, no delay needed
        return None
```

This removes the delay check from the common path and only applies it to ML mode.
  </action>
  <verify>Read manager.py and confirm _check_initial_delay is only called when mode == ML</verify>
  <done>Initial delay logic only applies to ML mode, manual mode has no delay</done>
</task>

<task type="auto">
  <name>Task 2: Update docstrings and logging</name>
  <files>src/services/control/manager.py</files>
  <action>
Update the docstring for _check_initial_delay() to clarify it's only used for ML mode:
- Change "Check if initial delay period has passed" to "Check if ML mode initial delay period has passed"
- Add note that manual mode bypasses this entirely

Update process_data() docstring decision tree comment to reflect new logic:
```
Decision tree:
1. Check cutting state
2. If ML mode: check initial delay, then calculate speeds
3. If Manual mode: no action (operator controls directly)
```
  </action>
  <verify>Read updated docstrings to confirm accuracy</verify>
  <done>Docstrings accurately describe mode-aware behavior</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Manual mode skips initial delay entirely (no _check_initial_delay call)
- [ ] ML mode still uses initial delay (target_distance_mm or default_delay_ms)
- [ ] Application starts without errors
- [ ] No syntax errors: `python -m py_compile src/services/control/manager.py`
</verification>

<success_criteria>

- Manual mode: no delay at cutting start
- ML mode: existing delay behavior preserved
- Docstrings updated to reflect mode-aware logic
- No regressions in control flow
  </success_criteria>

<output>
After completion, create `.planning/phases/11-initial-delay-logic/11-01-SUMMARY.md`
</output>
