---
phase: 01-ml-schema-update
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/services/database/schemas.py]
autonomous: true
---

<objective>
Update ML predictions database schema to include torque and head height fields.

Purpose: Enable historical analysis of torque and head height data alongside ML predictions.
Output: Updated SCHEMA_ML_DB with serit_motor_tork and kafa_yuksekligi columns.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Source files:
@src/services/database/schemas.py
@src/domain/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add serit_motor_tork and kafa_yuksekligi columns to ML schema</name>
  <files>src/services/database/schemas.py</files>
  <action>
    Modify SCHEMA_ML_DB to add two new columns to the ml_predictions table:

    1. Add `serit_motor_tork REAL` after `inme_hizi_input` - stores band motor torque percentage
    2. Add `kafa_yuksekligi REAL` after `serit_motor_tork` - stores head height in mm

    Place these columns BEFORE the output columns (yeni_kesme_hizi, etc.) to maintain logical grouping:
    - Input features group: akim_input, sapma_input, kesme_hizi_input, inme_hizi_input, serit_motor_tork, kafa_yuksekligi
    - Output group: yeni_kesme_hizi, yeni_inme_hizi, katsayi, ml_output

    Add comments to clarify the new fields:
    - serit_motor_tork: "Band motor torque (%)"
    - kafa_yuksekligi: "Head height (mm)"

    Note: This is schema DEFINITION only. The schema is used by SQLite to CREATE TABLE IF NOT EXISTS.
    Existing databases will need ALTER TABLE in Phase 3 (data population phase) to add these columns.
  </action>
  <verify>
    - Python syntax valid: `python -m py_compile src/services/database/schemas.py`
    - Schema contains new columns: `grep -E "serit_motor_tork|kafa_yuksekligi" src/services/database/schemas.py`
  </verify>
  <done>
    - SCHEMA_ML_DB contains serit_motor_tork REAL column
    - SCHEMA_ML_DB contains kafa_yuksekligi REAL column
    - Both columns placed after inme_hizi_input and before yeni_kesme_hizi
    - Schema compiles without Python syntax errors
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -m py_compile src/services/database/schemas.py` succeeds
- [ ] `grep -E "serit_motor_tork|kafa_yuksekligi" src/services/database/schemas.py` shows both columns
- [ ] Column order is logical (input fields together, output fields together)
</verification>

<success_criteria>

- SCHEMA_ML_DB updated with both new columns
- No Python syntax errors
- Schema maintains backward compatibility (new columns are optional/nullable)
</success_criteria>

<output>
After completion, create `.planning/phases/01-ml-schema-update/01-01-SUMMARY.md`
</output>
