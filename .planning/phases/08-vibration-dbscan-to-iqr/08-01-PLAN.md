---
phase: 08-vibration-dbscan-to-iqr
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/anomaly/detectors.py]
autonomous: true
---

<objective>
Replace DBSCAN with IQR for vibration anomaly detectors (TitresimX, TitresimY, TitresimZ).

Purpose: Eliminate O(n²) DBSCAN complexity in favor of O(n) IQR method for consistent 100ms cycle time.
Output: Three vibration detectors using IQR method, aligned with config.yaml declaration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase confirms no blockers
@.planning/phases/07-mqtt-lock-free-queue/07-01-SUMMARY.md

# Source files
@src/anomaly/detectors.py
@src/anomaly/base.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update vibration detectors to use IQR method</name>
  <files>src/anomaly/detectors.py</files>
  <action>
Change three vibration detector classes from DBSCAN to IQR:

1. TitresimXDetector (lines 83-94):
   - Change docstring: "Uses DBSCAN method (advanced)" → "Uses IQR method (robust to outliers)"
   - Change constructor: `method=DetectionMethod.DBSCAN` → `method=DetectionMethod.IQR`
   - Change log message: "(DBSCAN method)" → "(IQR method)"

2. TitresimYDetector (lines 97-108):
   - Same changes as TitresimXDetector

3. TitresimZDetector (lines 111-122):
   - Same changes as TitresimZDetector

Pattern to follow: SeritSapmasiDetector, SeritKesmeHiziDetector, SeritInmeHiziDetector, SeritGerginligiDetector all use this exact pattern.

Do NOT modify base.py - the DBSCAN implementation should remain available for potential future use or runtime method switching via config.
  </action>
  <verify>
Run: python -c "from src.anomaly.detectors import TitresimXDetector, TitresimYDetector, TitresimZDetector; from src.anomaly.base import DetectionMethod; x=TitresimXDetector(); y=TitresimYDetector(); z=TitresimZDetector(); assert x.method == DetectionMethod.IQR; assert y.method == DetectionMethod.IQR; assert z.method == DetectionMethod.IQR; print('All vibration detectors use IQR')"
  </verify>
  <done>
- TitresimXDetector.method == DetectionMethod.IQR
- TitresimYDetector.method == DetectionMethod.IQR
- TitresimZDetector.method == DetectionMethod.IQR
- Docstrings updated to reflect IQR method
- Log messages updated to show IQR method
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify application startup and anomaly detection</name>
  <files>src/anomaly/detectors.py</files>
  <action>
Verify the changes work correctly:

1. Import check: Ensure detectors module loads without errors
2. Instantiation check: Create AnomalyManager and verify detector methods
3. Method check: Confirm get_stats() shows "iqr" for all titresim detectors

Run quick functional test:
```python
from src.anomaly.manager import AnomalyManager
manager = AnomalyManager()
stats = manager.get_stats()
print(stats['detector_methods'])
# Should show titresim_x, titresim_y, titresim_z all as "iqr"
```
  </action>
  <verify>
Run: python -c "from src.anomaly.manager import AnomalyManager; m=AnomalyManager(); s=m.get_stats(); methods=s['detector_methods']; assert methods['titresim_x']=='iqr'; assert methods['titresim_y']=='iqr'; assert methods['titresim_z']=='iqr'; print('AnomalyManager verification passed')"
  </verify>
  <done>
- AnomalyManager initializes without errors
- get_stats() shows "iqr" for titresim_x, titresim_y, titresim_z
- No import errors or runtime exceptions
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All three vibration detectors use DetectionMethod.IQR
- [ ] Docstrings and log messages updated
- [ ] AnomalyManager initializes correctly
- [ ] Method reports show "iqr" for vibration sensors
- [ ] Python import/instantiation tests pass
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Vibration detectors aligned with config.yaml method declarations
- No DBSCAN usage in vibration detection path
</success_criteria>

<output>
After completion, create `.planning/phases/08-vibration-dbscan-to-iqr/08-01-SUMMARY.md`
</output>
