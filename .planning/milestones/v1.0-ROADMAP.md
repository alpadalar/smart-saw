# Milestone v1.0: Database Field Additions

**Status:** SHIPPED 2026-01-15
**Phases:** 1-3
**Total Plans:** 4

## Overview

Database schema guncellemesi icin uc asamali uygulama. ML predictions tablosuna tork ve kafa yuksekligi alanlari, anomaly events tablosuna kafa yuksekligi alani eklenerek gecmise donuk analiz icin veri zenginlestirilecek.

## Phases

### Phase 1: ML Schema Update

**Goal**: ML predictions tablosuna serit_motor_tork ve kafa_yuksekligi alanlarini eklemek
**Depends on**: Nothing (first phase)
**Plans**: 1 plan

Plans:
- [x] 01-01: Schema migration for ML database

**Details:**
- Added serit_motor_tork REAL column to ml_predictions table for band motor torque (%)
- Added kafa_yuksekligi REAL column to ml_predictions table for head height (mm)
- Maintained logical column ordering (input features grouped together)

### Phase 2: Anomaly Schema Update

**Goal**: Anomaly events tablosuna kafa_yuksekligi alanini eklemek
**Depends on**: Phase 1
**Plans**: 1 plan

Plans:
- [x] 02-01: Schema migration for anomaly database

**Details:**
- Added kafa_yuksekligi REAL column to anomaly_events table
- Column stores head height (mm) at time of anomaly detection
- Provides context for diagnosing cutting issues by knowing saw head position when anomaly occurred

### Phase 3: Data Population

**Goal**: Yeni alanlarin veri yazma mantigina entegrasyonu
**Depends on**: Phase 2
**Plans**: 2 plans (parallel wave)

Plans:
- [x] 03-01: Update ML data writing logic (ml_controller.py)
- [x] 03-02: Update anomaly data writing logic (anomaly_tracker.py, data_processor.py)

**Details:**
- Updated _log_ml_prediction method to accept and insert serit_motor_tork and kafa_yuksekligi
- Modified _predict_coefficient to receive raw_data and pass sensor values to logging
- Added kafa_yuksekligi parameter to record_anomaly method in anomaly_tracker.py
- Updated _save_anomaly_to_db to include kafa_yuksekligi in INSERT statement
- Modified data_processor to pass raw_data.kafa_yuksekligi_mm when recording anomalies

---

## Milestone Summary

**Key Decisions:**

- Sadece kayit amacli ekleme (ML model inputu degismeyecek, geriye donuk analiz icin)
- ALTER TABLE kullanimi (Mevcut veri kaybi onlenmeli)
- Place ML columns in input features group (Logical ordering: input features together, output fields together)
- Place kafa_yuksekligi after kesim_id (kesim_id is a reference while kafa_yuksekligi is measurement data)
- Use instantaneous torque value (Direct raw_data.serit_motor_tork_percentage rather than buffer average)
- Pass kafa_yuksekligi from raw_data directly (Value already available in scope at anomaly recording location)

**Issues Resolved:**

None - all plans executed without issues.

**Issues Deferred:**

None.

**Technical Debt Incurred:**

None.

---

_For current project status, see .planning/ROADMAP.md_
